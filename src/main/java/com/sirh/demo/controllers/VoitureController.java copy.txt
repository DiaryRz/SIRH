package com.example.Service_bus.controllers;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestBody;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.RestController;

import com.example.Service_bus.models.Retour;

import com.example.Service_bus.models.AuthRequest;
import com.example.Service_bus.models.Voiture;
import com.example.Service_bus.services.KeycloakService;
import com.example.Service_bus.services.VoitureService;

@RestController
public class VoitureController {

    private final KeycloakService keycloakService;

    @Autowired
    public VoitureController(KeycloakService keycloakService) {
        this.keycloakService = keycloakService;
    }
    @Autowired
    private VoitureService voitureService;

    @PostMapping("/voitures/create")
    public Retour creerVoiture(@RequestBody Voiture voiture,@RequestParam String chauffeur) throws Exception {
        return voitureService.creerVoitureAvecChauffeur(voiture,chauffeur);
    }

    @PostMapping("/voitures/update")
    public Retour modifierVoiture(@RequestParam String idVoiture,@RequestParam String chauffeur) throws Exception {
        return voitureService.ModifierVoiture(idVoiture, chauffeur);
    }

    @GetMapping("/voitures/byid")
    public Retour findVoitureById(@RequestParam String idVoiture) throws Exception {
        return voitureService.trouverParId(idVoiture);
    }
    @GetMapping("/voitures")
    public Retour selectVoiture() throws Exception {
        return voitureService.selectVoiture();
    }

    // @GetMapping("/voitures")
    // public List<Voiture> selectVoiture() throws Exception {
    //     try {
    //         String token = keycloakService.getToken("User1", "User1");
    //         System.out.println("Token obtenu avec succès : " + token);
    //         // Utilisez le token comme nécessaire
    //         return voitureService.selectVoiture();
    //     } catch (Exception e) {
    //         System.err.println("Erreur lors de l'obtention du token : " + e.getMessage());
    //         e.printStackTrace();
    //         throw e;
    //     }
    // }


    

    @GetMapping("/voitures/delete")
    public void supprimerVoiture(@RequestParam String idVoiture) throws Exception {
        voitureService.SupprimerVoiture(idVoiture);
    }
}